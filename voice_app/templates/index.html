# Navigate to your project
cd /c/Users/User/Desktop/Qubee_Project

# Create templates directory
mkdir -p voice_app/templates

# Create index.html file
cat > voice_app/templates/index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qubee Afan Oromo Voice to Text</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        h2 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #recordBtn {
            background: #28a745;
            color: white;
        }

        #stopBtn {
            background: #dc3545;
            color: white;
        }

        #uploadBtn {
            background: #007bff;
            color: white;
        }

        #copyBtn {
            background: #ffc107;
            color: #212529;
            margin-top: 15px;
        }

        input[type="file"] {
            padding: 10px;
            border: 2px dashed #6c757d;
            border-radius: 6px;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }

        #result {
            min-height: 150px;
            padding: 20px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 18px;
            line-height: 1.6;
            color: #1e293b;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
        }

        #recordStatus, #fileStatus {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
            min-height: 20px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 15px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.2rem;
            }
        }

        .recording {
            animation: pulse 1.5s infinite;
            color: #dc3545 !important;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .status {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 5px;
        }

        .status-label {
            font-weight: bold;
        }

        .status-value {
            font-weight: 600;
        }

        .status-value.ready {
            color: #28a745;
        }

        .status-value.error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Qubee Afan Oromo Voice to Text</h1>
        <p class="subtitle">Convert spoken Afan Oromo to Qubee text</p>
        
        <!-- Status Display -->
        <div class="card">
            <h2>üîß System Status</h2>
            <div class="status">
                <span class="status-label">Model:</span>
                <span id="modelStatus" class="status-value">Checking...</span>
            </div>
            <div class="status">
                <span class="status-label">Server:</span>
                <span id="serverStatus" class="status-value">Checking...</span>
            </div>
            <div class="status">
                <span class="status-label">Microphone:</span>
                <span id="micStatus" class="status-value">Checking...</span>
            </div>
        </div>
        
        <!-- Recording Section -->
        <div class="card">
            <h2>1. üéôÔ∏è Record Voice</h2>
            <p>Click to record using your microphone:</p>
            
            <div>
                <button id="recordBtn">
                    <span>üé§</span> Start Recording
                </button>
                <button id="stopBtn" disabled>
                    <span>‚èπÔ∏è</span> Stop Recording
                </button>
            </div>
            
            <div id="recordStatus">Click "Start Recording" to begin</div>
        </div>
        
        <!-- Upload Section -->
        <div class="card">
            <h2>2. üìÅ Upload Audio File</h2>
            <p>Select an audio file (WAV, MP3, M4A, OGG, FLAC):</p>
            
            <input type="file" id="audioFile" accept="audio/*,.wav,.mp3,.m4a,.ogg,.flac">
            <button id="uploadBtn">
                <span>üìÅ</span> Convert File
            </button>
            
            <div id="fileStatus">No file selected</div>
        </div>
        
        <!-- Results Section -->
        <div class="card">
            <h2>3. üìù Converted Text (Qubee)</h2>
            <div id="result">Your converted text will appear here...</div>
            <button id="copyBtn" style="display:none;">
                <span>üìã</span> Copy Text
            </button>
        </div>
        
        <!-- Instructions -->
        <div class="card" style="background: #e7f3ff; border-color: #b8daff;">
            <h3 style="color: #004085;">‚ÑπÔ∏è How to Use</h3>
            <p><strong>1. Record Voice:</strong> Click "Start Recording", speak Afan Oromo, then "Stop"</p>
            <p><strong>2. Upload File:</strong> Select an audio file and click "Convert File"</p>
            <p><strong>3. Get Text:</strong> Wait for conversion to Qubee script</p>
            <p><strong>4. Copy:</strong> Use the "Copy Text" button to copy the result</p>
        </div>
    </div>

    <script>
        // ============================================
        // DOM Elements
        // ============================================
        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const audioFile = document.getElementById('audioFile');
        const uploadBtn = document.getElementById('uploadBtn');
        const resultDiv = document.getElementById('result');
        const copyBtn = document.getElementById('copyBtn');
        const recordStatus = document.getElementById('recordStatus');
        const fileStatus = document.getElementById('fileStatus');
        const modelStatus = document.getElementById('modelStatus');
        const serverStatus = document.getElementById('serverStatus');
        const micStatus = document.getElementById('micStatus');

        // ============================================
        // Global Variables
        // ============================================
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        // ============================================
        // Utility Functions
        // ============================================

        // Get CSRF token for Django
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Update UI state
        function updateUI(state, message) {
            if (state === 'recording') {
                recordBtn.disabled = true;
                stopBtn.disabled = false;
                recordStatus.textContent = message || 'üé§ Recording... Speak Afan Oromo now!';
                recordStatus.className = 'recording';
            } else if (state === 'processing') {
                recordBtn.disabled = true;
                stopBtn.disabled = true;
                recordStatus.textContent = message || 'üîÑ Processing audio...';
                recordStatus.className = '';
            } else {
                recordBtn.disabled = false;
                stopBtn.disabled = true;
                recordStatus.textContent = message || 'Ready to record';
                recordStatus.className = '';
            }
        }

        // Show result in the result box
        function showResult(text, type = 'success') {
            resultDiv.textContent = text;
            if (type === 'success') {
                resultDiv.style.color = '#28a745';
                resultDiv.style.borderColor = '#28a745';
            } else if (type === 'error') {
                resultDiv.style.color = '#dc3545';
                resultDiv.style.borderColor = '#dc3545';
            } else if (type === 'loading') {
                resultDiv.style.color = '#0dcaf0';
                resultDiv.style.borderColor = '#0dcaf0';
            }
        }

        // ============================================
        // Status Checking
        // ============================================

        // Check model status
        async function checkModelStatus() {
            try {
                const response = await fetch('/status/');
                const data = await response.json();
                
                if (data.model_loaded) {
                    modelStatus.textContent = '‚úÖ Loaded (ResNet-18)';
                    modelStatus.className = 'status-value ready';
                } else {
                    modelStatus.textContent = '‚ùå Error';
                    modelStatus.className = 'status-value error';
                }
            } catch (error) {
                console.error('Failed to check model status:', error);
                modelStatus.textContent = '‚ùå Offline';
                modelStatus.className = 'status-value error';
            }
        }

        // Check server connection
        async function checkServerConnection() {
            try {
                const response = await fetch('/test/');
                const data = await response.json();
                
                if (data.success) {
                    serverStatus.textContent = '‚úÖ Connected';
                    serverStatus.className = 'status-value ready';
                } else {
                    serverStatus.textContent = '‚ùå Error';
                    serverStatus.className = 'status-value error';
                }
            } catch (error) {
                console.error('Server check failed:', error);
                serverStatus.textContent = '‚ùå Offline';
                serverStatus.className = 'status-value error';
            }
        }

        // Check microphone permission
        async function checkMicrophonePermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                micStatus.textContent = '‚úÖ Ready';
                micStatus.className = 'status-value ready';
                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                console.error('Microphone check failed:', error);
                micStatus.textContent = '‚ùå Permission needed';
                micStatus.className = 'status-value error';
            }
        }

        // ============================================
        // Audio Processing
        // ============================================

        // Send audio to server
        async function sendAudioToServer(audioData, endpoint) {
            const formData = new FormData();
            const fieldName = endpoint === '/convert/' ? 'audio_data' : 'voice_file';
            formData.append(fieldName, audioData, 'audio.wav');
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                    },
                    body: formData
                });
                
                return await response.json();
                
            } catch (error) {
                console.error('Network error:', error);
                return { success: false, error: 'Network error. Please try again.' };
            }
        }

        // ============================================
        // Event Listeners
        // ============================================

        // Start recording
        recordBtn.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        sampleRate: 16000,
                        channelCount: 1,
                        echoCancellation: true,
                        noiseSuppression: true
                    }
                });
                
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    
                    // Show processing
                    showResult('üîÑ Converting audio to Qubee text...', 'loading');
                    copyBtn.style.display = 'none';
                    updateUI('processing');
                    
                    // Send to server
                    const result = await sendAudioToServer(audioBlob, '/convert/');
                    
                    // Show result
                    if (result.success) {
                        showResult(result.text, 'success');
                        copyBtn.style.display = 'block';
                        updateUI('ready', '‚úÖ Conversion complete!');
                    } else {
                        showResult(`Error: ${result.error}`, 'error');
                        updateUI('ready', '‚ùå Conversion failed');
                    }
                    
                    // Clean up stream
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                isRecording = true;
                updateUI('recording');
                
            } catch (error) {
                console.error('Microphone error:', error);
                showResult('‚ùå Microphone access denied. Please allow microphone permissions.', 'error');
                updateUI('ready', '‚ùå Microphone error');
                micStatus.textContent = '‚ùå Permission denied';
                micStatus.className = 'status-value error';
            }
        });

        // Stop recording
        stopBtn.addEventListener('click', () => {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                isRecording = false;
            }
        });

        // File input change
        audioFile.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                fileStatus.textContent = `üìÑ Selected: ${file.name} (${sizeMB} MB)`;
                fileStatus.style.color = '#0dcaf0';
            } else {
                fileStatus.textContent = 'No file selected';
                fileStatus.style.color = '#666';
            }
        });

        // Upload file
        uploadBtn.addEventListener('click', async () => {
            if (audioFile.files.length === 0) {
                showResult('‚ùå Please select a file first', 'error');
                fileStatus.textContent = '‚ùå Please select a file';
                fileStatus.style.color = '#dc3545';
                return;
            }
            
            const file = audioFile.files[0];
            
            // Validate file size (50MB limit)
            if (file.size > 50 * 1024 * 1024) {
                showResult('‚ùå File too large (max 50MB)', 'error');
                fileStatus.textContent = '‚ùå File too large (max 50MB)';
                fileStatus.style.color = '#dc3545';
                return;
            }
            
            // Show processing
            showResult('üîÑ Converting file to Qubee text...', 'loading');
            copyBtn.style.display = 'none';
            fileStatus.textContent = 'üîÑ Processing...';
            fileStatus.style.color = '#0dcaf0';
            
            // Send to server
            const result = await sendAudioToServer(file, '/upload/');
            
            // Show result
            if (result.success) {
                showResult(result.text, 'success');
                copyBtn.style.display = 'block';
                fileStatus.textContent = `‚úÖ ${file.name} converted`;
                fileStatus.style.color = '#28a745';
            } else {
                showResult(`Error: ${result.error}`, 'error');
                fileStatus.textContent = '‚ùå Conversion failed';
                fileStatus.style.color = '#dc3545';
            }
        });

        // Copy text to clipboard
        copyBtn.addEventListener('click', async () => {
            const text = resultDiv.textContent;
            
            try {
                await navigator.clipboard.writeText(text);
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>‚úÖ</span> Copied!';
                copyBtn.style.background = '#28a745';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            } catch (error) {
                console.error('Copy failed:', error);
                alert('Failed to copy text to clipboard.');
            }
        });

        // ============================================
        // Initialize
        // ============================================

        // Initialize checks on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkModelStatus();
            checkServerConnection();
            checkMicrophonePermission();
            
            console.log('Qubee Voice Converter loaded');
        });
    </script>
</body>
</html>
EOF

echo "‚úÖ Template created at: voice_app/templates/index.html"